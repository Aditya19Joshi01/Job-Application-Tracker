{% extends "layout.html" %}

{% block content %}
<h2 class="mb-4">Add New Job Application</h2>
<form id="jobForm">
    <div class="form-group">
        <label for="company">Company</label>
        <input type="text" class="form-control" id="company" placeholder="Enter company name" required>
    </div>
    <div class="form-group">
        <label for="position">Position</label>
        <input type="text" class="form-control" id="position" placeholder="Enter job position" required>
    </div>
    <div class="form-group">
        <label for="status">Status</label>
        <select class="form-control" id="status">
            <option value="Applied">Applied</option>
            <option value="Interviewing">Interviewing</option>
            <option value="Offer">Offer</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Add Job</button>
</form>


    <h2 class="mt-5">Your Job Applications</h2>
    <div id="jobList" class="mt-3"></div>
{% endblock %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

<script>
    $(document).ready(function() {
        // Function to handle form submission
        $('#jobForm').submit(function(e) {
            e.preventDefault();  // Prevent the default form submission behavior
            console.log('Form submission triggered');

            let jobData = {
                company: $('#company').val(),
                position: $('#position').val(),
                status: $('#status').val(),
            };

            console.log('Job data:', jobData);

            $.ajax({
                url: '/api/v1/jobs',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(jobData),
                success: function(response) {
                    console.log('POST request success:', response);
                    alert('Job added successfully!');
                    loadJobs();  // Reload the job list after adding a new job
                },
                error: function(xhr) {
                    console.error('POST request failed:', xhr.responseText);
                    alert('Failed to add job: ' + xhr.responseText);
                }
            });
        });

        // Function to load job applications
        function loadJobs() {
            $.ajax({
                url: '/api/v1/jobs',
                method: 'GET',
                success: function(data) {
                    console.log('Loaded jobs:', data);
                    let jobList = $('#jobList');
                    jobList.empty();
                    data.forEach(function(job) {
                        jobList.append(`
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">${job.company} - ${job.position}</h5>
                                    <p class="card-text">Status: ${job.status}</p>
                                    <p class="card-text">Applied on: ${new Date(job.date_applied).toLocaleDateString()}</p>
                                    ${job.notes ? `<p class="card-text">Notes: ${job.notes}</p>` : ''}
                                </div>
                            </div>
                        `);
                    });
                },
                error: function() {
                    alert('Failed to load jobs');
                }
            });
        }

        // Load jobs when the page loads
        loadJobs();
    });
</script>
